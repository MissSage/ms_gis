var A=Object.defineProperty,B=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var M=(e,a,i)=>a in e?A(e,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[a]=i,g=(e,a)=>{for(var i in a||(a={}))k.call(a,i)&&M(e,i,a[i]);if(E)for(var i of E(a))q.call(a,i)&&M(e,i,a[i]);return e},P=(e,a)=>B(e,O(a));import{aL as G,$ as Y,b8 as _,o2 as L,b0 as U,ac as Z,iD as H,bo as J,o3 as b,o4 as K,o5 as Q,o6 as W,o7 as X,o8 as aa,o9 as ea,oa as ia,ob as na,oc as ta,od as oa,oe as la,of as sa}from"./vendor.ad8aa1ba.js";let x=null;function ra(e,a,i){return e.x<0?e.x+=a:e.x>i&&(e.x-=a),e}function ua(e,a,i,l){const t=L(i)?U(i):null,s=t?Math.round((t.valid[1]-t.valid[0])/a.scale[0]):null;return e.map(o=>{const n=new G(Y(o.geometry));return _(a,n,n,n.hasZ,n.hasM),o.geometry=t?ra(n,s,l[0]):n,o})}function ma(e,a=18,i,l,t,s){const o=new Float64Array(t*s);a=Math.round(Z(a));let n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,u=0,f=0,d=0,c=0;const I=Q(l,i);for(const{geometry:T,attributes:v}of e){const{x:p,y:m}=T,y=Math.max(0,p-a),V=Math.max(0,m-a),N=Math.min(s,m+a),C=Math.min(t,p+a),S=+I(v);for(let w=V;w<N;w++)for(let h=y;h<C;h++){const D=w*t+h,j=W(h-p,w-m,a),R=o[D];u=o[D]+=j*S;const $=u-R;f+=$,d+=$*$,u<n&&(n=u),u>r&&(r=u),c++}}if(!c)return{mean:0,stddev:0,min:0,max:0,mid:0,count:0};const z=(r-n)/2;return{mean:f/c,stdDev:Math.sqrt((d-f*f/c)/c),min:n,max:r,mid:z,count:c}}async function F(e,a){if(!a)return[];const{field:i,field2:l,field3:t,fieldDelimiter:s}=e,o=e.valueExpression,n=e.normalizationType,r=e.normalizationField,u=e.normalizationTotal,f=[],d=e.viewInfoParams;let c=null,I=null;if(o){if(!x){const{arcadeUtils:v}=await H();x=v}c=x.createFunction(o),I=d&&x.getViewInfo({viewingMode:d.viewingMode,scale:d.scale,spatialReference:new J(d.spatialReference)})}const z=e.fieldInfos,T=!(a[0]&&"declaredClass"in a[0]&&a[0].declaredClass==="esri.Graphic")&&z?{fields:z}:null;return a.forEach(v=>{const p=v.attributes;let m;if(o){const y=T?P(g({},v),{layer:T}):v,V=x.createExecContext(y,I);m=x.executeFunction(c,V)}else p&&(m=p[i],l&&(m=`${b(m)}${s}${b(p[l])}`,t&&(m=`${m}${s}${b(p[t])}`)));if(n&&typeof m=="number"&&isFinite(m)){const y=p&&parseFloat(p[r]);m=K(m,n,y,u)}f.push(m)}),f}async function ca(e){const{attribute:a,features:i}=e,{normalizationType:l,normalizationField:t,minValue:s,maxValue:o,fieldType:n}=a,r=await F({field:a.field,valueExpression:a.valueExpression,normalizationType:l,normalizationField:t,normalizationTotal:a.normalizationTotal,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},i),u=X({normalizationType:l,normalizationField:t,minValue:s,maxValue:o}),f={value:.5,fieldType:n},d=n==="esriFieldTypeString"?aa({values:r,supportsNullCount:u,percentileParams:f}):ea({values:r,minValue:s,maxValue:o,useSampleStdDev:!l,supportsNullCount:u,percentileParams:f});return ia(d,n==="esriFieldTypeDate")}async function pa(e){const{attribute:a,features:i}=e,l=await F({field:a.field,field2:a.field2,field3:a.field3,fieldDelimiter:a.fieldDelimiter,valueExpression:a.valueExpression,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},i),t=na(l);return ta(t,a.domains,a.returnAllCodedValues,a.fieldDelimiter)}async function va(e){const{attribute:a,features:i}=e,{field:l,normalizationType:t,normalizationField:s,normalizationTotal:o,classificationMethod:n}=a,r=await F({field:l,valueExpression:a.valueExpression,normalizationType:t,normalizationField:s,normalizationTotal:o,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},i),u=oa(r,{field:l,normalizationType:t,normalizationField:s,normalizationTotal:o,classificationMethod:n,standardDeviationInterval:a.standardDeviationInterval,numClasses:a.numClasses,minValue:a.minValue,maxValue:a.maxValue});return la(u,n)}async function Ia(e){const{attribute:a,features:i}=e,{field:l,normalizationType:t,normalizationField:s,normalizationTotal:o,classificationMethod:n}=a,r=await F({field:l,valueExpression:a.valueExpression,normalizationType:t,normalizationField:s,normalizationTotal:o,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},i);return sa(r,{field:l,normalizationType:t,normalizationField:s,normalizationTotal:o,classificationMethod:n,standardDeviationInterval:a.standardDeviationInterval,numBins:a.numBins,minValue:a.minValue,maxValue:a.maxValue})}async function za(e){const{attribute:a,features:i}=e,{field:l,radius:t,fieldOffset:s,transform:o,spatialReference:n,size:r}=a,u=ua(i,o,n,r),{count:f,min:d,max:c,mean:I,stdDev:z}=ma(u,t,s,l,r[0],r[1]);return{count:f,min:d,max:c,avg:I,stddev:z}}export{va as classBreaks,za as heatmapStatistics,Ia as histogram,ca as summaryStatistics,pa as uniqueValues};
