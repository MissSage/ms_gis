import{aJ as u,aK as g,aL as I,dV as q,am as E,aV as G,jV as S,ok as Y,hu as b,gl as m,go as j,fE as N,iX as L,hm as D,gZ as C,ol as J,i8 as K,aR as W,W as v,gA as Z,om as H,g3 as $,jD as U,gK as X,kO as z,$ as f,dO as Q,fi as tt,fl as rt,hr as nt}from"./vendor.faf54504.js";import{a as O,x as et,g as at}from"./axisAngleDegrees.170f9094.js";import{T as h,i as y}from"./BufferView.4f86b08f.js";import{t as A,e as ot,r as x}from"./vec33.ab880470.js";import{O as it,h as st,L as lt,M as ct,j as pt,k as ut,R as gt,v as ft,V as ht}from"./projection.a53c5ea5.js";var d;let p=d=class extends q{constructor(t){super(t),this.origin=E(),this.translation=E(),this.rotation=O(),this.scale=G(1,1,1),this.geographic=!0}get localMatrix(){const t=m();return S(B,at(this.rotation),et(this.rotation)),Y(t,B,this.translation,this.scale),t}get localMatrixInverse(){return b(m(),this.localMatrix)}applyLocal(t,n){return j(n,t,this.localMatrix)}applyLocalInverse(t,n){return j(n,t,this.localMatrixInverse)}project(t,n){const r=new Float64Array(t.length),e=h.fromTypedArray(r),a=h.fromTypedArray(t);if(this.geographic){const s=N(n),c=m();return L(n,this.origin,c,s),D(c,c,this.localMatrix),A(e,a,c),C(r,s,0,r,n,0,r.length/3),r}const{localMatrix:o,origin:i}=this;J(o,K)?ot(e,a):A(e,a,o);for(let s=0;s<r.length;s+=3)r[s+0]+=i[0],r[s+1]+=i[1],r[s+2]+=i[2];return r}getOriginPoint(t){const[n,r,e]=this.origin;return new W({x:n,y:r,z:e,spatialReference:t})}equals(t){return v(t)&&this.geographic===t.geographic&&Z(this.origin,t.origin)&&H(this.localMatrix,t.localMatrix)}clone(){const t={origin:$(this.origin),translation:$(this.translation),rotation:O(this.rotation),scale:$(this.scale),geographic:this.geographic};return new d(t)}};u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"origin",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"translation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"rotation",void 0),u([g({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"scale",void 0),u([g({type:Boolean,nonNullable:!0,json:{write:!0}})],p.prototype,"geographic",void 0),u([g()],p.prototype,"localMatrix",null),u([g()],p.prototype,"localMatrixInverse",null),p=d=u([I("esri.geometry.support.MeshTransform")],p);const B=U(),yt=p;function w(t,n){var r;return t.isGeographic||t.isWebMercator&&((r=n==null?void 0:n.geographic)!=null?r:!0)}function P(t,n,r){return w(n.spatialReference,r)?wt(t,n,r):xt(t,n,r)}function mt(t,n,r){const{position:e,normal:a,tangent:o}=t;if(f(n))return{position:e,normal:a,tangent:o};const i=n.localMatrix;return P({position:gt(e,new Float64Array(e.length),i),normal:v(a)?ft(a,new Float32Array(a.length),i):null,tangent:v(o)?ht(o,new Float32Array(o.length),i):null},n.getOriginPoint(r),{geographic:n.geographic})}function Ot(t,n,r){var e;if(r==null?void 0:r.useTransform){const{position:a,normal:o,tangent:i}=t;return{vertexAttributes:{position:a,normal:o,tangent:i},transform:new yt({origin:[n.x,n.y,(e=n.z)!=null?e:0],geographic:w(n.spatialReference,r)})}}return{vertexAttributes:P(t,n,r),transform:null}}function At(t,n,r){return w(n.spatialReference,r)?V(t,n,r):M(t,n,r)}function Bt(t,n,r,e){if(f(n))return At(t,r,e);const a=mt(t,n,r.spatialReference);return r.equals(n.getOriginPoint(r.spatialReference))?M(a,r,e):w(r.spatialReference,e)?V(a,r,e):M(a,r,e)}function xt(t,n,r){const e=new Float64Array(t.position.length),a=t.position,o=n.x,i=n.y,s=n.z||0,{horizontal:c,vertical:T}=R(r?r.unit:null,n.spatialReference);for(let l=0;l<a.length;l+=3)e[l+0]=a[l+0]*c+o,e[l+1]=a[l+1]*c+i,e[l+2]=a[l+2]*T+s;return{position:e,normal:t.normal,tangent:t.tangent}}function wt(t,n,r){const e=n.spatialReference,a=_(n,r,F),o=new Float64Array(t.position.length),i=Tt(t.position,a,e,o),s=z(k,a);return{position:i,normal:vt(i,o,t.normal,s,e),tangent:$t(i,o,t.tangent,s,e)}}function Tt(t,n,r,e){A(h.fromTypedArray(e),h.fromTypedArray(t),n);const a=new Float64Array(t.length);return it(e,a,r)}function vt(t,n,r,e,a){if(f(r))return null;const o=new Float32Array(r.length);return x(y.fromTypedArray(o),y.fromTypedArray(r),e),st(o,t,n,a,o),o}function $t(t,n,r,e,a){if(f(r))return null;const o=new Float32Array(r.length);x(y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT),y.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),e);for(let i=3;i<o.length;i+=4)o[i]=r[i];return lt(o,t,n,a,o),o}function M(t,n,r){const e=new Float64Array(t.position.length),a=t.position,o=n.x,i=n.y,s=n.z||0,{horizontal:c,vertical:T}=R(r?r.unit:null,n.spatialReference);for(let l=0;l<a.length;l+=3)e[l+0]=(a[l+0]-o)/c,e[l+1]=(a[l+1]-i)/c,e[l+2]=(a[l+2]-s)/T;return{position:e,normal:t.normal,tangent:t.tangent}}function V(t,n,r){const e=n.spatialReference;_(n,r,F);const a=b(Ft,F),o=new Float64Array(t.position.length),i=dt(t.position,e,a,o),s=z(k,a);return{position:i,normal:Mt(t.normal,t.position,o,e,s),tangent:Rt(t.tangent,t.position,o,e,s)}}function _(t,n,r){L(t.spatialReference,[t.x,t.y,t.z||0],r,N(t.spatialReference));const{horizontal:e,vertical:a}=R(n?n.unit:null,t.spatialReference);return X(r,r,[e,e,a]),r}function dt(t,n,r,e){const a=ct(t,n,e),o=h.fromTypedArray(a),i=new Float64Array(a.length),s=h.fromTypedArray(i);return A(s,o,r),i}function Mt(t,n,r,e,a){if(f(t))return null;const o=pt(t,n,r,e,new Float32Array(t.length)),i=y.fromTypedArray(o);return x(i,i,a),o}function Rt(t,n,r,e,a){if(f(t))return null;const o=ut(t,n,r,e,new Float32Array(t.length)),i=y.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT);return x(i,i,a),o}function R(t,n){if(f(t))return Et;const r=n.isGeographic?1:Q(n),e=n.isGeographic?1:tt(n),a=rt(1,t,"meters");return{horizontal:a*r,vertical:a*e}}const F=m(),Ft=m(),k=nt(),Et={horizontal:1,vertical:1};export{yt as L,Bt as M,Ot as _,At as b,mt as k,w as r,P as x};
