var N=Object.defineProperty,F=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var E=(s,e,t)=>e in s?N(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,w=(s,e)=>{for(var t in e||(e={}))U.call(e,t)&&E(s,t,e[t]);if(T)for(var t of T(e))q.call(e,t)&&E(s,t,e[t]);return s},I=(s,e)=>F(s,H(e));import{X as B,ap as M,U as G,ae as V,bG as P,ah as Y,O as y,ac as A,bH as $,bI as j,Y as z}from"./vendor.ad8aa1ba.js";import{d as _,b as C,S as O}from"./Utils.4c2feac4.js";import{U as L}from"./MaterialKey.6f6162d1.js";import{r as k,s as D}from"./definitions.d3c1cadf.js";import{C as r}from"./enums.2d9e6f64.js";const W=1/B("mapview-transitions-duration");class K extends M{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return G(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=V(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=V(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,t;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(t=this._fadeOutResolver)==null||t.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,c=this.computedOpacity;if(c===i)this.computedVisible=this.visible;else{const p=e*W;this.computedOpacity=c>i?Math.max(i,c-p):Math.min(i,c+p),this.computedVisible=this.computedOpacity>0;const a=i===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class se extends K{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this.children=[],this._effectView=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach(t=>t.clips=e)}get computedEffects(){var e,t;return(t=(e=this._effectView)==null?void 0:e.effects)!=null?t:null}get effect(){var e,t;return(t=(e=this._effectView)==null?void 0:e.effect)!=null?t:""}set effect(e){(this._effectView||e)&&(this._effectView||(this._effectView=new P),this._effectView.effect=e,this.requestRender())}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender())}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e||this.contains(e))return e;this._needsSort=!0;const i=e.parent;return i&&i!==this&&i.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}endTransitions(){super.endTransitions(),this._effectView&&(this._effectView.endTransitions(),this.requestRender())}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}sortChildren(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}beforeRender(e){super.beforeRender(e);for(const t of this.children)t.beforeRender(e)}afterRender(e){super.afterRender(e);for(const t of this.children)t.afterRender(e)}_createTransforms(){return{dvs:Y()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.processRender(e)}createRenderParams(e){return I(w({},e),{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition})}}class f{static getStorageSpec(e){return null}static createOrUpdateRendererSchema(e,t){return y(e)&&e.type==="default"?e:{type:"default"}}static getVariation(e){return{}}static getVariationHash(e){return 0}}f.type="default",f.programSpec=null;class g extends f{static getStorageSpec({attributes:e}){return{visualVariables:!1,attributes:e!=null?e:null}}static _createRendererSchema(){return{type:"dot-density",colors:new Float32Array(32),dotValue:-1,dotSize:-1,dotScale:-1,dotBlending:!1,backgroundColor:new Float32Array(4),activeDots:new Float32Array(8),seed:-1}}static createOrUpdateRendererSchema(e,t){const{attributes:i,dotValue:c,referenceScale:p,dotSize:a,dotBlendingEnabled:d,seed:n,backgroundColor:u}=t,h=y(e)&&e.type==="dot-density"?e:this._createRendererSchema();h.dotValue=c,h.dotSize=a,h.dotScale=p,h.dotBlending=d,h.seed=n;const{colors:S,activeDots:m,backgroundColor:l}=h;for(let o=0;o<k;o++){const b=o>=i.length?null:i[o].color;_(S,b,4*o)}for(let o=0;o<8;o++)m[o]=o<t.attributes.length?1:0;return _(l,u),h}static getVariation(e){return{ddDotBlending:e.dotBlending}}static getVariationHash(e){return e.dotBlending?1:0}}g.type="dot-density",g.programSpec={shader:"materials/fill",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:r.SHORT},{location:1,name:"a_id",count:3,type:r.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:r.UNSIGNED_BYTE},{location:3,name:"a_inverseArea",count:1,type:r.FLOAT}]}};class R extends f{static getStorageSpec({field:e,valueExpression:t}){return{visualVariables:!1,attributes:e||t?[{field:e,valueExpression:t}]:null}}static _createRendererSchema(){return{type:"heatmap",radius:-1,referenceScale:-1,isFieldActive:0,minDensity:-1,densityRange:-1,kernel:null,gradient:null,gradientHash:"invalid"}}static createOrUpdateRendererSchema(e,t){const{radius:i,minDensity:c,maxDensity:p,referenceScale:a,field:d,valueExpression:n,colorStops:u}=t,h=p-c,S=d||n?1:0,m=u.map(({color:b,ratio:x})=>`${x}:${b.toString()}`).join();let l,o=!0;return y(e)&&e.type==="heatmap"?(l=e,o=m!==e.gradientHash):l=this._createRendererSchema(),l.radius=A(i),l.minDensity=c,l.densityRange=h,l.referenceScale=a,l.isFieldActive=S,o&&(l.gradient=$(u),l.gradientHash=m),l}}R.type="heatmap",R.programSpec={shader:"materials/icon/heatmapAccumulate",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:r.SHORT},{location:1,name:"a_vertexOffset",count:2,type:r.SHORT},{location:4,name:"a_id",count:4,type:r.UNSIGNED_BYTE}]}};class v extends f{static getStorageSpec({attributes:e}){return{visualVariables:!0,attributes:e!=null?e:null}}static _createRendererSchema(){return{type:"pie-chart",colors:new Float32Array(4*D),defaultColor:new Float32Array(4),othersColor:new Float32Array(4),outlineColor:new Float32Array(4),holePercentage:0,sectorThreshold:0,outlineWidth:1,numberOfFields:10}}static createOrUpdateRendererSchema(e,t){const{attributes:i,defaultColor:c,holePercentage:p,othersCategory:a,outline:d}=t,n=y(e)&&e.type==="pie-chart"?e:this._createRendererSchema();for(let u=0;u<D;u++){const h=u>=i.length?new j([0,0,0,0]):i[u].color;_(n.colors,h,4*u)}return _(n.defaultColor,c),_(n.othersColor,a==null?void 0:a.color),_(n.outlineColor,d==null?void 0:d.color),n.outlineWidth=A((d==null?void 0:d.width)||0),n.holePercentage=p,n.sectorThreshold=(a==null?void 0:a.threshold)||0,n.numberOfFields=i.length,n}static getVariation(e){return{numberOfFields:e.numberOfFields}}static getVariationHash(e){return e.numberOfFields}}v.type="pie-chart",v.programSpec={shader:"materials/pie",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:r.SHORT},{location:1,name:"a_vertexOffset",count:2,type:r.SHORT},{location:2,name:"a_texCoords",count:2,type:r.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:r.UNSIGNED_SHORT},{location:4,name:"a_id",count:4,type:r.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:r.UNSIGNED_BYTE,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:r.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:r.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:r.UNSIGNED_SHORT}]},hittestAttributes:["a_vertexOffset","a_texCoords"]};function ie(s,e){if(s.type!==e)throw new z("material-view-model:unexpected-renderer-schema",`expected to find renderer schema of type "${e}" but found type "${s.type}"`)}function re(s){switch(s==null?void 0:s.type){case"dot-density":return g;case"heatmap":return R;case"pie-chart":return v;default:return f}}function ae(s){const{geometryType:e,symbologyType:t}=L.load(s);switch(e){case C.FILL:if(t===O.DOT_DENSITY)return g;break;case C.MARKER:switch(t){case O.HEATMAP:return R;case O.PIE_CHART:return v}}return f}export{re as c,f as e,se as i,ae as p,K as r,ie as s};
