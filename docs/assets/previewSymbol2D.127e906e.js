var A=Object.defineProperty,B=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var Z=(a,e,n)=>e in a?A(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n,M=(a,e)=>{for(var n in e||(e={}))Y.call(e,n)&&Z(a,n,e[n]);if(E)for(var n of E(e))H.call(e,n)&&Z(a,n,e[n]);return a},x=(a,e)=>B(a,R(e));import{bI as S,pV as z,ac as v,pW as $,pX as D,pY as I,Y as X,pZ as T,p_ as _,p$ as G,ck as J}from"./vendor.ad8aa1ba.js";import{o as K}from"./fontUtils.c3d9f30f.js";function N(a){let{r:e,g:n,b:s,a:o}=a;return o<1&&(e=Math.round(o*e+255*(1-o)),n=Math.round(o*n+255*(1-o)),s=Math.round(o*s+255*(1-o))),new S({r:e,g:n,b:s})}function q(a){const{r:e,g:n,b:s}=N(a);return .2126*e+.7152*n+.0722*s}const O="picture-fill",Q="picture-marker",ee="simple-fill",ae="simple-line",ne="simple-marker",se="text",te="Aa",ie=z.size,L=z.maxSize,le=z.maxOutlineSize,oe=z.lineWidth,P=225,ce=document.createElement("canvas");function U(a,e){const n=ce.getContext("2d"),s=[];return e&&(e.weight&&s.push(e.weight),e.size&&s.push(e.size+"px"),e.family&&s.push(e.family)),n.font=s.join(" "),n.measureText(a).width}const re=7.2/2.54,ue=72/2.54;function he(a){if(a.length===0)return 0;if(a.length>2){const e=J(1),n=parseFloat(a);switch(a.slice(-2)){case"px":return n;case"pt":return n*e;case"in":return 72*n*e;case"pc":return 12*n*e;case"mm":return n*re*e;case"cm":return n*ue*e}}return parseFloat(a)}function k(a){const e=a==null?void 0:a.size;return{width:e!=null&&typeof e=="object"&&"width"in e?v(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?v(e.height):null}}async function me(a,e){const n=e.fill,s=a.color;if((n==null?void 0:n.type)==="pattern"&&s&&a.type!==O){const o=await G(n.src,s.toCss(!0));n.src=o,e.fill=n}}async function pe(a,e,n,s){if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await K(a.font)}catch{}const{width:o}=k(s),m=/[\uE600-\uE6FF]/.test(e.shape.text);o!=null||m||(n[0]=U(e.shape.text,{weight:e.font.weight,size:e.font.size,family:e.font.family}))}function V(a,e){return a>e?"dark":"light"}function de(a,e){var C;const n=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,s=n!=null?v(n):null,o=(e==null?void 0:e.maxSize)!=null?v(e.maxSize):null,m=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in a?a.angle:null,g=$(a);let h=D(a);fe(a,245)!=="dark"||(e==null?void 0:e.ignoreWhiteSymbols)||(h=x(M({width:.75},h),{color:"#bdc3c7"}));const r={shape:null,fill:g,stroke:h,offset:[0,0]};(h==null?void 0:h.width)&&(h.width=Math.min(h.width,le));const p=(h==null?void 0:h.width)||0;let w=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),t=0,i=0,b=!1;switch(a.type){case ne:{const c=a.style,{width:u,height:l}=k(e),f=u===l&&u!=null?u:s!=null?s:Math.min(v(a.size),o||L);switch(t=f,i=f,c){case"circle":r.shape={type:"circle",cx:0,cy:0,r:.5*f},w||(t+=p,i+=p);break;case"cross":r.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[t,.5*i]},{command:"M",values:[.5*t,0]},{command:"L",values:[.5*t,i]}]};break;case"diamond":r.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*t,0]},{command:"L",values:[t,.5*i]},{command:"L",values:[.5*t,i]},{command:"Z",values:[]}]},w||(t+=p,i+=p);break;case"square":r.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},w||(t+=p,i+=p),m&&(b=!0);break;case"triangle":r.shape={type:"path",path:[{command:"M",values:[.5*t,0]},{command:"L",values:[t,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},w||(t+=p,i+=p),m&&(b=!0);break;case"x":r.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,i]},{command:"M",values:[t,0]},{command:"L",values:[0,i]}]},m&&(b=!0);break;case"path":r.shape={type:"path",path:a.path||""},w||(t+=p,i+=p),m&&(b=!0),w=!0}break}case ae:{const{width:c,height:u}=k(e),l=u!=null?u:s!=null?s:p,f=c!=null?c:oe;h&&(h.width=l),t=f,i=l;const y=((C=r==null?void 0:r.stroke)==null?void 0:C.cap)||"butt",d=y==="round";w=!0,r.stroke&&(r.stroke.cap=y==="butt"?"square":y),r.shape={type:"path",path:[{command:"M",values:[d?l/2:0,i/2]},{command:"L",values:[d?t-l/2:t,i/2]}]};break}case O:case ee:{const c=typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.isSquareFill),{width:u,height:l}=k(e);t=!c&&u!==l||u==null?s!=null?s:ie:u,i=!c&&u!==l||l==null?t:l,w||(t+=p,i+=p),w=!0,r.shape=c?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,i]},{command:"L",values:[0,i]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:I.fill[0];break}case Q:{const c=Math.min(v(a.width),o||L),u=Math.min(v(a.height),o||L),{width:l,height:f}=k(e),y=l===f&&l!=null?l:s!=null?s:Math.max(c,u),d=c/u;t=d<=1?Math.ceil(y*d):y,i=d<=1?y:Math.ceil(y/d),r.shape={type:"image",x:-Math.round(t/2),y:-Math.round(i/2),width:t,height:i,src:a.url||""},m&&(b=!0);break}case se:{const c=a,u=(e==null?void 0:e.overrideText)||c.text||te,l=c.font,{width:f,height:y}=k(e),d=y!=null?y:s!=null?s:Math.min(v(l.size),o||L),W=U(u,{weight:l.weight,size:d,family:l.family}),j=/[\uE600-\uE6FF]/.test(u);t=f!=null?f:j?d:W,i=d;let F=.25*he((l?d:0).toString());j&&(F+=5),r.shape={type:"text",text:u,x:c.xoffset||0,y:c.yoffset||F,align:"middle",alignBaseline:c.verticalAlignment,decoration:l&&l.decoration,rotated:c.rotated,kerning:c.kerning},r.font=l&&{size:d,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}return{shapeDescriptor:r,size:[t,i],renderOptions:{node:e==null?void 0:e.node,scale:w,opacity:e==null?void 0:e.opacity,rotation:m,useRotationSize:b,effectView:e==null?void 0:e.effectView}}}async function ve(a,e){const{shapeDescriptor:n,size:s,renderOptions:o}=de(a,e);if(!n.shape)throw new X("symbolPreview: renderPreviewHTML2D","symbol not supported.");await me(a,n),await pe(a,n,s,e);const m=[[n]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.applyColorModulation)){const g=.6*s[0];m.unshift([x(M({},n),{offset:[-g,0],fill:T(n.fill,-.3)})]),m.push([x(M({},n),{offset:[g,0],fill:T(n.fill,.3)})]),s[0]+=2*g,o.scale=!1}return _(m,s,o)}function fe(a,e=P){const n=$(a),s=D(a),o=!n||"type"in n?null:new S(n),m=(s==null?void 0:s.color)?new S(s==null?void 0:s.color):null,g=o?V(q(o),e):null,h=m?V(q(m),e):null;return h?g?g===h?g:e>=P?"light":"dark":h:g}export{fe as getContrastingBackgroundTheme,de as getRenderSymbolParameters,ve as previewSymbol2D};
