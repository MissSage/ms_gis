var L=Object.defineProperty,O=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var S=(e,n,t)=>n in e?L(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,D=(e,n)=>{for(var t in n||(n={}))$.call(n,t)&&S(e,t,n[t]);if(k)for(var t of k(n))P.call(n,t)&&S(e,t,n[t]);return e},M=(e,n)=>O(e,R(n));import{aD as y,aE as w,mY as N,aF as z,dP as B,bG as G,U as C,O as A}from"./vendor.1bde3be2.js";var T;let h=T=class extends B{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new T({variableName:this.variableName,dimensionName:this.dimensionName,values:G(this.values),isSlice:this.isSlice})}};y([w({type:String,json:{write:!0}})],h.prototype,"variableName",void 0),y([w({type:String,json:{write:!0}})],h.prototype,"dimensionName",void 0),y([w({type:N.array(N.oneOf([N.native(Number),N.array(N.native(Number))])),json:{write:!0}})],h.prototype,"values",void 0),y([w({type:Boolean,json:{write:!0}})],h.prototype,"isSlice",void 0),h=T=y([z("esri.layers.support.DimensionalDefinition")],h);const F=h;function Y(e,n,t){var a;const o=n.shift();if(t.length===0){const s=[];t.push({sliceId:-1,multidimensionalDefinition:s})}const i=t.length;for(let s=0;s<i;s++){const u=t.shift().multidimensionalDefinition;(a=o.values)==null||a.forEach(m=>{t.push({sliceId:-1,multidimensionalDefinition:[...u,{variableName:e,dimensionName:o.name,values:[m]}]})})}n.length&&Y(e,n,t)}function K(e,n){const t=[];let o=0;return(n?e.variables.filter(i=>i.name.toLowerCase()===n.toLowerCase()):[...e.variables].sort((i,a)=>i.name>a.name?1:-1)).forEach(i=>{const a=[],s=[...i.dimensions].sort((u,m)=>u.name>m.name?-1:1);Y(i.name,s,a),a.forEach(u=>{t.push(M(D({},u),{sliceId:o++}))})}),t}function Q(e,n,t){let o=e;if(n&&(n=[...n].sort((i,a)=>i.dimensionName<a.dimensionName?-1:1)).forEach(({dimensionName:i,values:a,isSlice:s})=>{a.length&&(o=o.filter(u=>{const m=u.multidimensionalDefinition.find(r=>r.dimensionName===i);if(m==null)return!1;const l=m.values[0];return typeof l=="number"?typeof a[0]=="number"?a.includes(l):a.some(r=>r[0]<=l&&r[1]>=l):typeof a[0]=="number"?a.some(r=>l[0]<=r&&l[1]>=r):s?a.some(r=>r[0]===l[0]&&r[0]===l[1]):a.some(r=>r[0]>=l[0]&&r[0]<=l[1]||r[1]>=l[0]&&r[1]<=l[1]||r[0]<l[0]&&r[1]>l[1])}))}),o.length&&t&&A(t.start)&&A(t.end)){const i=t.start.getTime(),a=t.end.getTime(),s=o[0].multidimensionalDefinition.findIndex(u=>u.dimensionName==="StdTime");s>-1&&(o=o.filter(u=>{const m=u.multidimensionalDefinition[s].values[0];return i<=m&&a>=m}))}return o.map(i=>i.sliceId)}function x(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function V(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function I(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function E(e,n,t){var s,u,m;if(!((s=n==null?void 0:n.subsetDefinitions)==null?void 0:s.length))return e;let o;if(t){const{variables:l}=n;if(l.length&&!l.includes(t))return null;const r=n.subsetDefinitions.find(c=>c.dimensionName===e.name&&c.variableName===t);if(!((u=r==null?void 0:r.values)==null?void 0:u.length))return e;o=I(r.values)}else o=(m=n.dimensions.find(({name:l})=>l===e.name))==null?void 0:m.extent;const i=o;if(!i||!(i==null?void 0:i.length))return e;const a=e.values.filter(l=>x(l,i));return M(D({},e),{extent:[...i],values:a})}function W(e,n,t){var i;if(!((i=n==null?void 0:n.subsetDefinitions)==null?void 0:i.length))return!1;const{variables:o}=n;if(o.length&&e.some(({variableName:a})=>a&&!o.includes(a)))return!0;for(let a=0;a<e.length;a++){const s=e[a],u=n.subsetDefinitions.find(m=>(s.variableName===""||m.variableName===s.variableName)&&m.dimensionName===s.dimensionName);if(u==null?void 0:u.values.length){const m=I(u.values);if(!s.isSlice&&s.values.length===2&&!Array.isArray(s.values[0])&&s.values[0]!==s.values[1]&&t){if(!V(s.values,m))return!0}else if(s.values.some(l=>!x(l,m)))return!0}}return!1}function X(e,n={}){var c,v,b;const{multidimensionalInfo:t,keyProperties:o}=e;if(C(t))return null;const i=n.variableName||(o==null?void 0:o.DefaultVariable);let{variables:a}=t;const{multidimensionalSubset:s}=n;((c=s==null?void 0:s.variables)==null?void 0:c.length)&&(a=a.filter(({name:d})=>s.variables.includes(d)));const u=i&&(v=a.find(({name:d})=>d===i))!=null?v:a[0];if(!u)return null;const m=[],{dimensions:l,name:r}=u;if(l.length===0)return[new F({variableName:r,dimensionName:"",values:[],isSlice:!0})];for(let d=0;d<l.length;d++){const g=E(l[d],s,r);if(!g)return null;const{values:f,extent:p}=g;let U=(b=f==null?void 0:f[0])!=null?b:p[0];g.name.toLowerCase()==="stdz"&&!g.hasRanges&&Math.abs(p[1])<=Math.abs(p[0])&&(U=(f==null?void 0:f.length)?f[f.length-1]:p[1]),m.push(new F({variableName:r,dimensionName:g.name,values:[U],isSlice:!n.useRangeForRangedDimensionInfo||!!g.hasRanges}))}return m}function Z(e){return!(C(e)||!e.length)&&e.some(n=>{if(n.values==null)return!0;const t=n.values.length;return t===0||t>1||!n.isSlice&&Array.isArray(n.values[0])})}function _(e,n){var o;if(C(n)||C(e))return null;let t=n.variables.map(i=>D({},i));return((o=e==null?void 0:e.variables)==null?void 0:o.length)&&(t=t.filter(({name:i})=>e.variables.includes(i)),t.forEach(i=>{i.dimensions=i.dimensions.map(a=>E(a,e,i.name))})),t}function q(e,n){var u;const{values:t}=n;if(t==null?void 0:t.length)return Array.isArray(t[0])!==Array.isArray(e)?-1:Array.isArray(t[0])?t.findIndex(m=>m[0]===e[0]&&m[1]===e[1]):t.indexOf(e);const{extent:o}=n;if(Array.isArray(e)||e<o[0]||e>o[1])return-1;const i=n.interval||1;if(n.unit!=="ISO8601")return Math.round((e-o[0])/i);const a=o[0];let s=-1;switch(((u=n.intervalUnit)==null?void 0:u.toLowerCase())||"seconds"){case"seconds":s=Math.round((e-a)/1e3/i);break;case"minutes":s=Math.round((e-a)/6e4/i);break;case"hours":s=Math.round((e-a)/36e5/i);break;case"days":s=Math.round((e-a)/864e5/i);break;case"months":{const m=new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear(),l=new Date(a).getUTCMonth(),r=new Date(e).getUTCMonth();s=m===0?r-l:r+11-l+12*(m-1)}break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear())/i);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear())/10/i)}return s}function j(e){var s,u,m;let n=(s=e.values)==null?void 0:s.length;if(n)return n;const{extent:t,unit:o}=e,i=e.interval||1,a=t?t[1]-t[0]:0;if(o!=="ISO8601")return Math.round(a/i);switch((m=(u=e.intervalUnit)==null?void 0:u.toLowerCase())!=null?m:"seconds"){case"seconds":n=Math.round(a/1e3/i);break;case"minutes":n=Math.round(a/6e4/i);break;case"hours":n=Math.round(a/36e5/i);break;case"days":n=Math.round(a/864e5/i);break;case"months":{const l=new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear(),r=new Date(t[1][0]).getUTCMonth(),c=new Date(t[1][1]).getUTCMonth();n=l===0?c-r+1:c+11-r+12*(l-1)+1}break;case"years":n=Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/i);break;case"decades":n=Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/10/i);break;default:n=0}return n}function ee(e,n){let t=0;const o=e[0].variableName,i=[...n.variables].sort((a,s)=>a.name>s.name?1:-1);for(let a=0;a<i.length;a++){const s=i[a],u=[...s.dimensions].sort((r,c)=>r.name>c.name?-1:1);if(s.name!==o){t+=u.map(r=>j(r)).reduce((r,c)=>r*c);continue}const m=u.map(r=>j(r)),l=u.length;for(let r=0;r<l;r++){const c=e.find(b=>b.dimensionName===u[r].name);if(c==null)return null;const v=q(c.values[0],u[r]);if(v===-1)return null;m.shift(),t+=r===l-1?v:v*m.reduce((b,d)=>b*d)}break}return t}export{X as c,_ as d,Z as f,ee as g,K as i,W as m,F as p,Q as s};
